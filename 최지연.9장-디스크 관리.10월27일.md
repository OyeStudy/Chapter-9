## 디스크 관리
### 1. 디스크의 구조
디스크 외부에서 디스크를 일정한 크기의 저장공간들로 이루어진 1차원 배열처럼 취급하게 된다.    
이 일정한 크기의 저장공간을 논리블록(logical block)이라고 하며, 디스크에 데이터가 저장될 때에는 논리블록 단위로 저장되고, 디스크 외부로 입출력이 일어날 때에도 논리블록 단위로 전송된다.    
- 섹터(sector) : 각 논리블록이 저장되는 디스크 내의 물리적인 위치 
   
디스크의 물리적인 구조는 하나 또는 여러개의 마그네틱의 원판으로 구성된다.   
- 각각의 원판은 트랙(track)으로 구성되고, 각 트랙은 섹터로 나뉘며, 섹터에 최소한의 단위 정보가 저장된다.    
- 실린더(Cylinder) : 여러 개의 원판에서 상대적 위치가 동일한 트랙들의 집합    
- 섹터 0 : 최외곽 실린더의 첫번째 트랙에 있는 첫번째 섹터     

![](https://t1.daumcdn.net/cfile/tistory/998407335C74FC4026)
디스크에 데이터를 읽고 쓰기 위해서는 암(arm)이 해당 섹터가 위치한 실린더로 이동한 후 원판이 회전하여 디스크 헤드가 저장된 섹터 위치에 도달해야 한다.    

### 2. 디스크 스케줄링    
디스크에 대한 접근시간은 탐색시간(seek time), 회전지연시간(rotational latency), 전송시간(transfer time)으로 구분된다.    
- 탐색시간 : 디스크 헤드를 해당 실린더 위치로 이동시키는데 걸리는 시간(접근하려는 데이터가 원판의 안쪽/바깥쪽 어디에 있는지에 따라 다름)
- 회전지연시간 : 디스크가 회전해서 읽고 쓰려는 섹터가 헤드 위치에 도달하기까지 걸리는 시간    
- 전송시간 : 해당 섹터가 헤드 위치에 도달한 후 데이터를 실제로 섹터에 읽고 쓰는 데 소요되는 시간    

디스크 입출력의 효율을 높이기 위해서는 디스크 입출력에 소요되는 접근시간을 최소화해야 한다.
회전지연시간과 전송시간은 상대적인 수치가 작고, 운영체제 입장에서 통제하기도 힘들다.   
따라서, 운영체제는 탐색시간을 줄이기 위해 헤드의 움직임을 최소화하는 스케줄링 작업을 한다.     
- 디스크 스케줄링 : 효율적인 디스크 입출력을 위해 여러 섹터들에 대한 입출력 요청이 들어왔을 때 이들을 어떠한 순서로 처리할 것인지 결정하는 메커니즘    
- 디스크 스케줄링의 목표 : 디스크 헤드의 이동거리 줄이기      

#### 1) FCFS 스케줄링     
디스크에 먼저 들어온 요청을 먼저 처리하는 방식 

![image](https://user-images.githubusercontent.com/96704446/198064065-200da70a-0655-4302-b389-83911cf5bc28.png)    
- 최악의 경우, 입출력 요청이 디스크의 한쪽 끝과 반대쪽 끝에 번갈아 도착한다면 헤드는 디스크를 계속 왕복하여 일을 처리해야 하므로 탐색시간이 매우 비효율적으로 늘어난다.    

#### 2) SSTF 스케줄링     
헤드가 현재 위치로부터 가장 가까운 위치에 있는 요청을 제일 먼저 처리하는 알고리즘       

![image](https://user-images.githubusercontent.com/96704446/198065235-897d2e73-2805-44a4-956f-7462d312d8ad.png)

- 헤드의 이동거리를 줄여 디스크 입출력의 효율성을 증가시키지만, **기아현상(starvation)** 을 발생시킬 수 있다.  
ex) 현재 헤드 위치로부터 가까운 곳에서 지속적인 요청이 들어올 경우 헤드 위치에서 멀리 떨어진 곳의 요청은 무한히 기다려야 하는 문제가 발생할 수 있다. 

#### 3) SCAN 알고리즘(엘리베이터 스케줄링 알고리즘)     
헤드가 디스크 원판의 안쪽 끝과 바깥쪽 끝을 오가며, 그 경로에 존재하는 모든 요청을 처리한다.     
마치, 버스가 일정 경로에 따라 움직이며 정류장에서 기다리고 있는 사람들을 태우는 것과 유사한 방식이다.    
![image](https://user-images.githubusercontent.com/96704446/198066786-35818332-314d-41f0-bd99-e6aaf79cf80d.png)

- SCAN 알고리즘은 한쪽 끝에서 다른쪽 끝으로 한 번만 이동하면 현재 큐에 들어온 모든 요청을 처리할 수 있으므로 이동 거리 측면에서 매우 효율적이고(효율성), 일부 요청이 지나치게 오래 기다리는 현상도 발생하지 않는다(형평성)         
- 하지만, 모든 실린더 위치의 기다리는 시간이 공평한 것은 아니다. 제일 안쪽이나 제일 바깥쪽 위치보다는 가운데 위치가 기다리는 평균시간이 더 짧기 때문이다     
- 헤드가 가운데 위치를 지나가는 주기 = 1/2 * (양 끝을 지나가는 주기)
- SCAN 알고리즘의 위치에 따른 탐색시간의 편차를 보완하기 위해 C-SCAN 알고리즘이 제안되었다.     

#### 4) C-SCAN 알고리즘    
SCAN처럼 헤드가 한쪽 끝에서 다른쪽 끝으로 이동하며 가는 길목에 있는 모든 요청을 처리한다.    
하지만 SCAN과 달리, 헤드가 다른 쪽 끝에 도달해 방향을 바꾼 후에는 요청을 처리하지 않고 **곧바로 출발점으로 다시 이동만 한다.**    
- SCAN보다 헤드의 이동거리는 조금 길어지지만, 탐색시간의 편차를 줄일 수 있다.     

#### 5) LOOK과 C-LOOK 알고리즘     
SCAN 알고리즘에서는 요청의 존재 여부와 관계없이 헤드가 무조건 디스크의 한쪽 끝에서 다른 쪽 끝으로 이동한다.   
이에 반해, LOOK 알고리즘은 헤드가 한쪽 방향으로 이동하다가 그 방향에 더 이상 대기중이 요청이 없으면 헤드의 이동방향을 즉시 반대로 바꾸는 스케줄링 방식이다.    
- C-LOOK = LOOK + 한쪽 방향으로 이동할 때에만 요청을 처리(C-SCAN처럼)     

### 3. 다중 디스크 환경에서의 스케줄링     
다중 디스크 환경에서는 같은 데이터가 저장되어 있는 여러 개의 디스크 중 어느 디스크에서 요청을 처리할지 결정하는 스케줄링 문제까지 포함된다.    
이러한 시스템에서는 

다중 디스크 환경에서는 같은 데이터가 저장되어 있는 여러 개의 디스크 중 어느 디스크에서 요청을 처리할지 결정하는 스케줄링 문제가 발생한다.      
이러한 시스템에서는 스케줄링의 목표에 따라 요청을 처리할 디스크를 결정하는 기준이 달라진다.   
- 목표 : 탐색시간 줄이기, 디스크 간의 부하균형 이루기, 전력 소모 줄이기    

### 4. 디스크의 저전력 관리     
#### 1) 비활성화 기법    
디스크의 상태는 전력 소모를 기준으로 크게 네 가지 상태인 활동 상태, 공회전 상태, 준비 상태, 휴면 상태로 나누어볼 수 있다.     
- 활동 상태 : 현재 헤드가 데이터를 읽거나 쓰고 있는 상태     
- 공회전 상태 : 디스크가 회전 중이지만 데이터를 읽거나 쓰지는 않는 상태     
- 준비 상태 : 디스크가 회전하지 않지만 인터페이스가 활성화 된 상태   
- 휴면 상태 : 디스크가 회전하지 않고 인터페이스도 비활성화된 상태       

요청이 없을 경우 디스크를 정지(비활성 상태)시키는 것이 전력 절감 측면에서 효과적이지만, 각 상태로 전환할 때는 부가적인 전력 및 시간이 소모된다.     
따라서 후속 요청까지의 시간 간격이 일정 시간 이상일 경우에만 디스크의 회전을 정지시키는 것이 전력 소모를 절감하는 데 효과적이다.     
> 디스크를 비활성화하는 시점을 결정하는 방법으로는 시간기반 기법, 예측기반 기법, 확률기반 기법이 있다. 

![image](https://user-images.githubusercontent.com/96704446/198079166-c5aa1981-3aea-4f0c-8804-cda03d9a8a80.png)

#### 2) 회전속도 조절 기법        
- 운영체제에서는 전력 소모를 최소화하기 위해 디스크의 회전속도를 관리하는 지능형 전력 관리 기법에 대한 연구가 이루어지고 있다. 
- 멀티미디어 환경에서의 워크로드의 특성을 활용해 저전력을 위한 디스크 스케줄링을 하여 전력 소모를 줄인 연구도 있다.     

#### 3) 디스크의 데이터 배치 기법     
디스크 내에 데이터의 복제본을 많이 만들어 헤드 위치에서 가까운 복제본에 접근하도록 함으로써 빠른 응답시간과 전력 소모량 절감을 얻는 FS2 파일시스템이 제안됨    

#### 4) 버퍼캐싱 및 사전인출 기법        
미래에 요청될 데이터를 미리 알거나 어느 정도 예측할 수 있다면 디스크가 활성 상태일 때 헤드 위치로부터 가까운 데이터를 사전인출함으로써 향후 디스크의 비활성화 가능성을 높여 전력 소모를 줄일 수 있다.     

#### 5) 쓰기전략을 통한 저전력 디스크 기법      
대상 디스크가 비활성 상태일 때에는 디스크 쓰기를 하지 않고 기다렸다가, 디스크가 활성 상태로 돌아왔을 때 쓰는 방식

